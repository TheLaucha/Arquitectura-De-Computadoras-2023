TIMER EQU 10h
EOI EQU 20h
IMR EQU 21h
INT0 EQU 24h
INT1 EQU 25h
ID_CLK EQU 10
ID_F10 EQU 15

ORG 40
IP_CLK DW RUT_CLK

ORG 60
IP_F10 DW RUT_F10

ORG 1000H
  SEG DB 30h
      DB 30h

ORG 3000H
RUT_CLK: PUSH AX
  INC SEG+1
  CMP SEG+1, 3Ah
  JNZ SIGO
  INC SEG
  MOV SEG+1, 30h
  CMP SEG, 33h
  JNZ SIGO
  INC DL
  MOV AL, 0FFh
  OUT IMR, AL
SIGO: MOV AL, 2
  INT 7
  MOV AL, 0
  OUT TIMER, AL
  MOV AL, EOI
  OUT EOI, AL
  POP AX
  IRET

ORG 3500h
RUT_F10: PUSH AX
  IN AL, IMR
  XOR AL, 00000010b
  OUT IMR, AL
  MOV AL, EOI
  OUT EOI, AL
  POP AX
  IRET

ORG 2000H
  CLI
    MOV AL, 0FEh ; 1111 1110 
    OUT IMR, AL
    MOV AL, ID_F10
    OUT INT0, AL
    MOV AL, ID_CLK
    OUT INT1, AL
    MOV AL, 1
    OUT TIMER+1, AL
    MOV AL, 0
    OUT TIMER, AL
    MOV BX, OFFSET SEG
    MOV DL, 0
  STI
LOOP: CMP DL, 0
    JZ LOOP
    INT 0
END