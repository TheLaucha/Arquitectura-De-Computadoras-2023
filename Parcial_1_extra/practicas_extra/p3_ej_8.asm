EOI EQU 20h
IMR EQU 21h
INT2 EQU 26h
ID_HAND EQU 10
DATO EQU 40h
ESTADO EQU 41h

ORG 40
IP_HAND DW RUT_HAND

ORG 1000h
  MSJ DB "HOLA MUNDO"
  FIN_MSJ DB ?
  
ORG 3000h
RUT_HAND: PUSH AX
  MOV AL, [BX]
  OUT DATO, AL
  INC BX
  DEC DL
  JNZ FINAL
  MOV AL, 0FFh
  OUT IMR, AL
FINAL: MOV AL, EOI
  OUT EOI, AL
  POP AX
  IRET

ORG 2000h
; Configuro programa
  MOV BX, OFFSET MSJ
  MOV DL, OFFSET FIN_MSJ - OFFSET MSJ
  OUT ESTADO, AL
  CLI
    MOV AL, 0FBh ; 1111 1011
    OUT IMR, AL
    MOV AL, ID_HAND
    OUT INT2, AL
    MOV AL, 80h
    OUT ESTADO, AL
  STI
LOOP: CMP DL, 0
  JNZ LOOP
  ; Desactivo Handhsake
  IN AL, ESTADO
  AND AL, 07Fh ; 0111 1111
  OUT ESTADO, AL
  INF: JMP INF
  INT 0
END